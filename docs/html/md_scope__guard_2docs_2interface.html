<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>micromouse: interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">micromouse
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_scope__guard_2docs_2interface.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">interface</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><sup><em>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.</em></sup></p>
<h2><a class="anchor" id="autotoc_md10"></a>
Client interface</h2>
<p>The public interface consists of a template function to create scope guard objects, a few members of those objects, and one boolean compilation option that can be activated with a preprocessor macro definition.</p>
<p>Here is an outline of the client interface:</p>
<ul>
<li>Maker function template</li>
<li>Scope guard objects<ul>
<li>Invariants</li>
<li>Overview of public members</li>
<li>List of deleted public members</li>
<li>Member type `callback_type`</li>
<li>Member function `dismiss`</li>
<li>Member move constructor</li>
<li>Member destructor</li>
</ul>
</li>
<li>Compilation option `SG_REQUIRE_NOEXCEPT_IN_CPP17`</li>
</ul>
<h3><a class="anchor" id="autotoc_md11"></a>
Maker function template</h3>
<p>The free function template <code>make_scope_guard</code> resides in <code>namespace sg</code> and is the primary element of the public interface &ndash; most uses do not require anything else. It provides a way for clients to create a scope guard object that is <em>associated</em> with the specified callback.</p>
<p>Scope guards execute their <em>associated</em> callback when they are destroyed, unless they were meanwhile dismissed or moved. Like other variables, scope guards with automatic storage are destroyed when they go out of scope, hence the name.</p>
<p>This function template is <a href="design.md#sfinae-friendliness">SFINAE-friendly</a>.</p>
<h6>Function signature:</h6>
<div class="fragment"><div class="line">++</div>
<div class="line"> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Callback&gt;</div>
<div class="line"> <span class="comment">/* unspecified return type */</span> make_scope_guard(Callback&amp;&amp; callback)</div>
<div class="line"> <span class="keyword">noexcept</span>(std::is_nothrow_constructible&lt;Callback, Callback&amp;&amp;&gt;::value);</div>
</div><!-- fragment --><h6>Preconditions:</h6>
<p>The template and function arguments need to respect certain preconditions. They should all be intuitive to C++ programmers, with the possible exception of precondition 2. They are summarized here and discussed in more detail <a class="el" href="md_scope__guard_2docs_2precond.html">elsewhere</a>.</p>
<ol type="1">
<li><a href="precond.md#invocable-with-no-arguments">invocable with no arguments</a></li>
<li><a href="precond.md#void-return">void return</a></li>
<li><a href="precond.md#nothrow-invocable"><em>nothrow</em>-invocable</a></li>
<li><a href="precond.md#nothrow-destructible-if-non-reference-template-argument"><em>nothrow</em>-destructible if non-reference</a> template argument</li>
<li><a href="precond.md#const-invocable-if-const-reference">const-invocable if const reference</a></li>
<li><a href="precond.md#appropriate-lifetime-if-lvalue-reference">appropriate lifetime if lvalue reference</a></li>
<li><a href="precond.md#movable-or-copyable-if-non-reference">movable or copyable if non-reference</a></li>
</ol>
<p>By default, precondition 3 is not enforced at compile time. Precondition 6 is not enforced at compile time. All other preconditions are enforced at compile time.</p>
<h6>Postconditions:</h6>
<p>A scope guard object is returned with</p>
<ul>
<li>the provided callback as <em>associated</em> callback</li>
<li><em>active</em> state</li>
</ul>
<h6>Exception specification:</h6>
<p>As the signature shows, instances of this function template are <code>noexcept</code> <em>iff</em> <code>Callback</code> can be <em>nothrow</em> constructed from <code>Callback&amp;&amp;</code> (after reference collapsing). Notice this is always the case if <code>Callback</code> is a reference type.</p>
<h6>Example:</h6>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> guard = sg::make_scope_guard([]() <span class="keyword">noexcept</span> { <span class="comment">/* do stuff */</span> });</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md12"></a>
Scope guard objects</h3>
<p>Scope guard objects have some unspecified type that MUST NOT be used as a base class.</p>
<h4><a class="anchor" id="autotoc_md13"></a>
Invariants:</h4>
<ol type="1">
<li>A scope guard object that is in an <em>active</em> state executes its <em>associated</em> callback exactly once when leaving scope.</li>
<li>A scope guard that is in <em>inactive</em> state does not execute its <em>associated</em> callback</li>
</ol>
<h4><a class="anchor" id="autotoc_md14"></a>
Overview of public members:</h4>
<ol type="1">
<li>Type <code>callback_type</code></li>
<li><code>dismiss</code> function</li>
<li>move constructor</li>
<li>destructor</li>
</ol>
<h4><a class="anchor" id="autotoc_md15"></a>
List of &lt;em&gt;deleted&lt;/em&gt; public members:</h4>
<ol type="1">
<li>default constructor</li>
<li>copy constructor</li>
<li>copy assignment operator</li>
<li>move assignment operator</li>
</ol>
<p>Note: Deleted special members cannot be used, but they participate in overload resolution. They are listed here because they are explicitly disallowed and that can be considered as part of the the client's interface.</p>
<h4><a class="anchor" id="autotoc_md16"></a>
Member type &lt;tt&gt;callback_type&lt;/tt&gt;</h4>
<p>Template argument deduction allows the underlying callback type to be automatically derived from the function argument. That type &ndash; <code>Callback</code> in the signature of <code>make_scope_guard</code> above &ndash; is provided as the member type <code>callback_type</code>.</p>
<h6>Member type declaration:</h6>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">typedef</span> Callback callback_type;</div>
</div><!-- fragment --><h6>Example:</h6>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">using </span>my_cb = <span class="keyword">typename</span> <span class="keyword">decltype</span>(guard)::callback_type; <span class="comment">/* where guard</span></div>
<div class="line"><span class="comment">                                              is a scope guard object */</span></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md17"></a>
Member function &lt;tt&gt;dismiss&lt;/tt&gt;</h4>
<p>Scope guards can be dismissed to cancel callback execution. Dismissed scope guards are valid but useless. They are best regarded as garbage awaiting destruction.</p>
<h6>Member function signature:</h6>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">void</span> dismiss() noexcept;</div>
</div><!-- fragment --><h6>Preconditions:</h6>
<p>None.</p>
<h6>Postconditions:</h6>
<p>The dismissed scope guard is in <em>inactive</em> state.</p>
<h6>Exception specification:</h6>
<p><code>noexcept</code>.</p>
<h6>Example:</h6>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">bool</span> do_transaction()</div>
<div class="line">{ <span class="comment">// example with early returns</span></div>
<div class="line">  <span class="keywordflow">if</span>(!do_step1())</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> undo = sg::make_scope_guard(rollback);</div>
<div class="line">  <span class="keywordflow">if</span>(!do_step2());</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">  <span class="keywordflow">if</span>(!do_step3());</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">  undo.dismiss(); <span class="comment">// &lt;-- using dismiss</span></div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md18"></a>
Member move constructor</h4>
<p>Objects created with <code>make_scope_guard</code> can be moved. This possibility exists mainly to allow initialization with assignment syntax, as in <code>auto g1 = make_scope_guard(f);</code>. In general, it allows transferring scope guarding responsibility: <code>auto g2 = std::move(g1);</code>.</p>
<p>A scope-guard move transfers the callback and corresponding call responsibility (or lack thereof). Moved-from scope guards are valid but useless. They are best regarded as garbage awaiting destruction.</p>
<h6>Member function signature:</h6>
<p>Standard move constructor.</p>
<h6>Preconditions:</h6>
<p>None.</p>
<h6>Postconditions:</h6>
<ul>
<li>The moved-from guard is in <em>inactive</em> state.</li>
<li>The moved-from guard is <em>associated</em> with an unspecified callback.</li>
<li>The moved-to guard is in the same <em>activity</em> state as the moved-from guard was in before the move operation (<em>active</em> moved-to <em>iff</em> previously <em>active</em> moved-from).</li>
<li>The moved-to guard is <em>associated</em> with the callback that was associated with the moved-from guard before the move operation;</li>
</ul>
<h6>Exception specification:</h6>
<p><code>noexcept</code> <em>iff</em> <code>Callback</code> can be <em>nothrow-constructed</em> from <code>Callback&amp;&amp;</code> (after reference collapse). Notice this is always the case when <code>Callback</code> is a reference type.</p>
<h6>Example:</h6>
<div class="fragment"><div class="line"> ++</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">auto</span> g1 = sg::make_scope_guard([]() <span class="keyword">noexcept</span> { std::cout &lt;&lt; <span class="stringliteral">&quot;bla&quot;</span>; });</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">auto</span> g2 = std::move(g1);</div>
<div class="line">  } <span class="comment">// g2 leaves scope here</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;ble&quot;</span>;</div>
<div class="line">} <span class="comment">// g1 leaves scope here</span></div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;bli&quot;</span>;</div>
<div class="line"><span class="comment">// prints &quot;blablebli&quot;</span></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md19"></a>
Member destructor</h4>
<p>Scope guards have a (non-virtual) destructor.</p>
<h6>Member function signature:</h6>
<p>Standard destructor.</p>
<h6>Preconditions:</h6>
<p>None.</p>
<h6>Postconditions:</h6>
<ul>
<li>the callback was executed <em>iff</em> the guard was in <em>active</em> state before destruction;</li>
<li>the guard is no longer valid</li>
</ul>
<h6>Exception specification:</h6>
<p><code>noexcept</code>. This motivates two of the preconditions: <a href="precond.md#nothrow-invocable"><em>nothrow</em>-invocable</a> and <a href="precond.md#nothrow-destructible-if-non-reference-template-argument"><em>nothrow</em>-destructible if non-reference</a>.</p>
<h6>Example:</h6>
<p>Non applicable.</p>
<h3><a class="anchor" id="autotoc_md20"></a>
Compilation option &lt;tt&gt;SG_REQUIRE_NOEXCEPT_IN_CPP17&lt;/tt&gt;</h3>
<p>If &ge;C++17 is used, the preprocessor macro <code>SG_REQUIRE_NOEXCEPT_IN_CPP17</code> can be defined to require <em>nothrow-invocable</em> callbacks in <code>make_scope_guard</code> at compile time.</p>
<p>Notice however, that this restricts accepted callback types <a href="design.md#implications-of-requiring-noexcept-callbacks-at-compile-time">considerably</a>.</p>
<p>This option is disabled by default and enabling it has no effect unless &ge;C++17 is used.</p>
<h6>Example:</h6>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#define SG_REQUIRE_NOEXCEPT_IN_CPP17 </span><span class="comment">// (no effect in &lt;C++17)</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="scope__guard_8hpp.html">scope_guard.hpp</a>&quot;</span></div>
<div class="line">make_scope_guard([](){}); <span class="comment">// ERROR: need noexcept (if &gt;=C++17)</span></div>
<div class="line">make_scope_guard([]() <span class="keyword">noexcept</span> {}); <span class="comment">// OK</span></div>
<div class="ttc" id="ascope__guard_8hpp_html"><div class="ttname"><a href="scope__guard_8hpp.html">scope_guard.hpp</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
